<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Brendan Malone" />

<meta name="date" content="2016-03-11" />

<title>SpectralPreTreatments</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>


<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div class="fluid-row" id="header">


<h1 class="title">SpectralPreTreatments</h1>
<h4 class="author"><em>Brendan Malone</em></h4>
<h4 class="date"><em>2016-03-11</em></h4>

</div>


<div id="sydney-soil-school" class="section level1">
<h1><span style="color:brown"><strong>Sydney Soil School</strong></span></h1>
<div id="soil-spectral-inference-workshop" class="section level3">
<h3><em>Soil Spectral Inference Workshop</em></h3>
</div>
<div id="march-30---april-1-2016" class="section level3">
<h3>March 30 - April 1, 2016</h3>
</div>
</div>
<div id="pretreatment-and-preprocessing-of-soil-spectra" class="section level1">
<h1>Pretreatment and preprocessing of soil spectra</h1>
<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>Before making full use of our spectra for prediction of soil properties, we need to do spectra preprocessing. In the process of doing spectroscopic analysis, the sample volume, sample preparation, measurement method, and the measuring parameters, such as the choice of the scanning times and the scanning resolution will more or less bring inevitable noise to the spectral data. Further, when analyzing phenomena with non-uniform particle size of solids such as soils, the reflectance spectrum is often accompanied by scattering noise. At our disposal however are a number of spectral smoothing, filtering and signal enhancing algorithms to ensure that we can best use the spectra for soil property inference. While there may be many potential preprocessing algorithms, base lining procedures and other such spectral pretreatments, the few that are described below are often used for soil spectroscopy. A useful reference that describes in more detail each of these pretreatments is <span class="citation">Buddenbaum and Steffens (2012)</span>.<br />
</p>
<p>The pretreatments of particular focus in this exercise are:</p>
<ul>
<li>The Savitzkty-Golay smoothing filter</li>
<li>Standard-normal variate transformation (SNV)</li>
<li>Multiplicative scatter correction (MSC)</li>
<li>Continuum removal with convex hull</li>
</ul>
<p>We then have a look at a few data reduction or compression methods which essentially reduce our spectra to a smaller dimension:</p>
<ul>
<li>Resample and averaging</li>
<li>Wavelets</li>
</ul>
</div>
</div>
<div id="spectra-pretreatments" class="section level1">
<h1>Spectra Pretreatments</h1>
<div id="getting-things-prepared" class="section level3">
<h3>Getting things prepared</h3>
<p>There are a few R packages we need to use for the following examples</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(spectroscopy)
<span class="kw">library</span>(signal)
<span class="kw">library</span>(plyr)
<span class="kw">library</span>(wavethresh)</code></pre></div>
<p>We will be using the vis-NIR spectra data set <strong>spectra.txt</strong> files as used in previous examples. We call this object <tt> spectra </tt>. Using the <tt> dim </tt> function returns us the dimensions of the spectral dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(spectra)</code></pre></div>
<pre><code>## [1]  389 2152</code></pre>
<p>Next, we just want to curate the dataset a little. The first column of the dataset has spectral labels which we do not need. Secondly we can add column names to indicate the wavelength that each column of data represents.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nc &lt;-<span class="st"> </span><span class="kw">ncol</span>(spectra)
spectra &lt;-<span class="st"> </span>spectra[, <span class="dv">2</span>:nc] <span class="co">#remove first column</span>
wavelength &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">350</span>, <span class="dv">2500</span>, <span class="dt">by =</span> <span class="dv">1</span>) <span class="co">#wavelength sequence</span>
<span class="kw">colnames</span>(spectra) &lt;-<span class="st"> </span>wavelength <span class="co">#append column names</span></code></pre></div>
<p>We get some sense of the data we are working with by plotting the first spectrum.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(wavelength, spectra[<span class="dv">1</span>, ], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span> ,<span class="dt">ylab=</span> <span class="st">&quot;reflectance&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" alt /></p>
</div>
<div id="converting-data-from-reflectance-values-to-absorbance-values." class="section level3">
<h3>Converting data from reflectance values to absorbance values.</h3>
<p>Soil spectral inference modeling seeks to derive the empirical relationship between measured soil properties and the associated spectral absorbance features of soil. If spectra is recorded as reflectance units, than we need to perform a conversion. This is done by calculating <span class="math inline">\(\log(1/R)\)</span> where <em>R</em> is the measured reflectance for a given wavelength. The script below does the conversion very efficiently for every spectrum in the data set. We call the new object (signifying the absorbance values) as <tt> spectraA </tt>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spectraA &lt;-<span class="st"> </span><span class="kw">log</span>(<span class="dv">1</span>/spectra)

<span class="co">#Plot first spectrum</span>
<span class="kw">plot</span>(wavelength, spectraA[<span class="dv">1</span>, ], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;absorbance&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" alt /></p>
</div>
<div id="spectral-trimming" class="section level3">
<h3>Spectral trimming</h3>
<p>Trimming spectra is a generic procedure where we may wish to focus an analysis upon a specific spectral range, to remove those wavelengths that have a low signal-to-noise ratio. For example, it is a common convention with vis-NIR data to remove the wavelengths from 350-499nm and 2451-2500nm. Effectively we just want to retain the wavelengths in the spectral range of 500-2450. Without a common procedure for performing such an operation, we need to customize a function or routine ourselves so that this procedure can be easily automated. The function also needs to be generalized i.e. the specification of wavelength regions of interest needs to be flexible, and complimentary to the input spectral data.</p>
<p>A function is just a set of general instructions for given specific inputs that when executed will return a given output or outputs. There is no need to try to interpret the function below. However, note that it requires 2 inputs: <tt> spectra </tt> (the data set upon which we want to apply the spectral trim) and <tt> wavlimits </tt> (the region of interest we want to extract). The trimming function is called <tt>trimSpec</tt> and comes pre-packaged in the <tt>spectroscopy</tt> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Function for trimming spectra or targeting a specific spectral region of interest</span>
trimSpec &lt;-<span class="st"> </span>function(spectra, wavlimits) {
datawavs &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">names</span>(spectra))
limits &lt;-<span class="st"> </span><span class="kw">which</span>(datawavs %in%<span class="st"> </span>wavlimits)
kept_index &lt;-<span class="st"> </span><span class="kw">seq</span>(limits[<span class="dv">1</span>], limits[<span class="dv">2</span>], <span class="dv">1</span>)
trimmed_spectra &lt;-<span class="st"> </span>spectra[, kept_index]
kept_names &lt;-<span class="st"> </span>datawavs[kept_index]
<span class="kw">colnames</span>(trimmed_spectra) &lt;-<span class="st"> </span>kept_names
<span class="kw">return</span>(trimmed_spectra)}</code></pre></div>
<p>For our purposes we want to trim the spectra or essentially extract all the spectral data between and including 500nm and 2451nm. Note that we specify this region of interest (<tt>wavlimits</tt>) as <tt>range(500:2451)</tt> which equates simply as the integers 500, 2451.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># TRIMMING THE SPECTRA</span>
specTrim &lt;-<span class="st"> </span><span class="kw">trimSpec</span>(<span class="dt">spectra =</span> spectraA, <span class="dt">wavlimits =</span> <span class="kw">range</span>(<span class="dv">500</span>:<span class="dv">2451</span>))</code></pre></div>
<p>Plotting the spectrum as before is the same, except now we need to specify the new wavelength sequence of the trimmed spectra.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">wavelength &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">500</span>, <span class="dv">2451</span>, <span class="dt">by =</span> <span class="dv">1</span>) <span class="co"># new wavelength sequence</span>
<span class="kw">plot</span>(wavelength, specTrim[<span class="dv">1</span>, ], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;absorbance&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" alt /></p>
</div>
<div id="savitzky-golay-smoothing-filter" class="section level2">
<h2>Savitzky-Golay smoothing filter</h2>
<p>First pretreatment is the Savitzky-Golay smoothing filter. This filter performs a local polynomial regression (of degree <em>k</em>) on a series of values <em>n</em> to determine the smoothed value for each point (this is the filter length). Here we just want to perform the filter with second-order polynomials and use a filter length of 11. Note that the type of polynomial and window size can be changed to suit one’s own specifications. The general <tt>R</tt> scripting form of the Savitzky-Golay filter is shown below. It is implemented in the <tt>spectroscopy</tt> package via the <tt>filter_spectra</tt> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Function for applying Savitsky-Golay smoothing filter</span>
filter_sg &lt;-<span class="st"> </span>function(spectra, n, p, m) {
spectra &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(spectra)
## run filter
sg &lt;-<span class="st"> </span><span class="kw">aaply</span>(spectra, <span class="dv">1</span>, sgolayfilt, <span class="dt">n =</span> n, <span class="dt">p =</span> p, <span class="dt">m =</span> m)
## arrange appropriately if a single sample
if (<span class="kw">nrow</span>(spectra) ==<span class="st"> </span><span class="dv">1</span>) {
sg &lt;-<span class="st"> </span><span class="kw">matrix</span>(sg, <span class="kw">dim</span>(spectra))}
## return data frame
sg&lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(sg)
<span class="kw">colnames</span>(sg) &lt;-<span class="st"> </span><span class="kw">colnames</span>(spectra)
<span class="kw">return</span>(sg)
}</code></pre></div>
<p>Essentially this function uses the <tt>sgolayfilt</tt> function from the <tt>signal</tt> package. It uses the <tt>aaply</tt> function from the <tt>plyr</tt> package to run the filter over the entire spectra collection. The parameters that it needs to operate with include: The spectra; a value for <tt>n</tt> i.e the window size; a value for <tt>p</tt> i.e the polynomial order; and a value for <tt>m</tt> which is whether or not the derivative of the polynomial is returned. To return the first derivative we would set the value of <tt>m</tt> to 1. However, we just want to filter our spectra without returning the derivatives, in which case we set <tt>m</tt> to 0. So let’s run the function and make a plot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#load R libraries necessary to use filter_sg</span>
<span class="kw">library</span>(signal);<span class="kw">library</span>(plyr)
<span class="co">#filter spectra dataset</span>
spec_filtered &lt;-<span class="st"> </span><span class="kw">filter_spectra</span>(specTrim,<span class="dt">type=</span><span class="st">&quot;S-Golay&quot;</span> ,<span class="dt">n =</span> <span class="dv">11</span>, <span class="dt">p =</span> <span class="dv">2</span>, <span class="dt">m =</span> <span class="dv">0</span>)
<span class="co">#plot first spectrum</span>
<span class="kw">plot</span>(wavelength, spec_filtered[<span class="dv">1</span>, ], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,<span class="dt">ylab =</span> <span class="st">&quot;absorbance&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" alt /></p>
<div id="first-and-second-order-derivatives" class="section level3">
<h3>First and second order derivatives</h3>
<p>Continuing on from just smoothing the spectra with the Savitsky-Golay filter, taking the derivatives of the smoothing functions provides means of accentuating the regions of absorbance. Using the <tt>filter_spectra</tt> function again, we just need to specify 1 or 2 to indicate whether we want to take the first or second derivative of the smoothed spectra respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Take first derivative of spectra</span>
spec_deriv1 &lt;-<span class="st"> </span><span class="kw">filter_spectra</span>(specTrim,<span class="dt">type=</span><span class="st">&quot;S-Golay&quot;</span> ,<span class="dt">n =</span> <span class="dv">11</span>, <span class="dt">p =</span> <span class="dv">2</span>, <span class="dt">m =</span> <span class="dv">1</span>)
<span class="co">#plot first spectrum</span>
<span class="kw">plot</span>(wavelength, spec_deriv1[<span class="dv">1</span>, ], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;fist derivative&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" alt /></p>
</div>
</div>
<div id="standard-normal-variate-transformation" class="section level2">
<h2>Standard normal variate transformation</h2>
<p>Standard normal variate transform (SNV), also known as <em>z</em>-transformation or as centering and scaling, normalizes each spectrum (which we will define as <span class="math inline">\(\rho\)</span>) to zero mean and unit variance by subtracting the mean of the spectrum (<span class="math inline">\(\overline{\rho}\)</span>) and dividing the difference by its standard deviation (<span class="math inline">\(\sigma_{\rho}\)</span>):</p>
<p><span class="math display">\[SVN= \frac{\rho-\overline{\rho}}{\sigma_{\rho}}\]</span></p>
<p>This is algorithm can be applied to each soil spectrum one at a time. Put into a function, it can be scripted as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Function for applying Standard Normal Variate Transformation</span>
snvBLC &lt;-<span class="st"> </span>function(spectra) {
spectra &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(spectra)
snvMat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol =</span> <span class="kw">ncol</span>(spectra), <span class="dt">nrow =</span> <span class="kw">nrow</span>(spectra))
for (i in <span class="dv">1</span>:<span class="kw">nrow</span>(spectra)) {
snvMat[i, ] &lt;-<span class="st"> </span>(spectra[i, ] -<span class="st"> </span><span class="kw">mean</span>(spectra[i, ]))/<span class="kw">sd</span>(spectra[i,])}
snvMat&lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(snvMat)
<span class="kw">colnames</span>(snvMat) &lt;-<span class="st"> </span><span class="kw">colnames</span>(spectra)
<span class="kw">return</span>(snvMat)}</code></pre></div>
<p>This function performs SNV for all the spectra in the collection and outputs a new SNV transformed spectra data set. All it requires is the spectra table for input. We can thus run it as follows via the <tt>filter_spectra</tt> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spec_snvC &lt;-<span class="st"> </span><span class="kw">filter_spectra</span>(spec_filtered, <span class="dt">type =</span> <span class="st">&quot;SNV&quot;</span>)
<span class="co">#plot first spectrum</span>
<span class="kw">plot</span>(wavelength, spec_snvC[<span class="dv">1</span>, ], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,<span class="dt">ylab =</span> <span class="st">&quot;SVN units&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" alt /></p>
</div>
<div id="multiplicative-scatter-correction" class="section level2">
<h2>Multiplicative scatter correction</h2>
<p>Multiplicative scatter correction (MSC) works by correcting each spectra to an <em>ideal</em> spectrum so that baseline and amplification effects are at the same average level in every spectrum. As this ideal spectrum is unknown, the mean spectrum of a given spectral library or data set (which we define as <span class="math inline">\(\overline{x}\)</span>) is used. This spectrum represents the mean scattering and offset. Each spectrum is then fitted to the mean spectrum using the least squares method:</p>
<p><span class="math display">\[x_{i}= a_{i}+b_{i} \overline{x}+e_{i}\]</span></p>
<p>Ideally <span class="math inline">\(e_{i}\)</span> contains the important information, because scattering and offset are represented by the coefficients <span class="math inline">\(a_{i}\)</span> and <span class="math inline">\(b_{i}\)</span>. The MSC spectrum is calculated by determining the coefficients for each spectrum and then performing the transformation as follows:</p>
<p><span class="math display">\[MSC= \frac{x_{i}- a_{i}}{b_{i}}\]</span></p>
<p>The MSC function can be scripted as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Function for applying Multiplicative Scatter Correction</span>
mscBLC &lt;-<span class="st"> </span>function(spectra) {
<span class="co">#first calculate a mean spectrum.</span>
meanSpec &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">colMeans</span>(spectra))
mscMat &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="ot">NA</span>, <span class="dt">ncol =</span> <span class="kw">ncol</span>(spectra), <span class="dt">nrow =</span> <span class="kw">nrow</span>(spectra))
spectra &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(spectra)
for (i in <span class="dv">1</span>:<span class="kw">nrow</span>(spectra)) {
<span class="co"># determine the slope and intercept co-efficents</span>
specLM &lt;-<span class="st"> </span><span class="kw">lm</span>(spectra[i, ] ~<span class="st"> </span>meanSpec)
specCE &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">as.matrix</span>(specLM$coefficients))
<span class="co"># Adjust the spectra</span>
mscMat[i, ] &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">as.matrix</span>((spectra[i, ] -<span class="st"> </span>specCE[<span class="dv">1</span>, <span class="dv">1</span>])/specCE[<span class="dv">1</span>,<span class="dv">2</span>]))}
mscMat&lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(mscMat)
<span class="kw">colnames</span>(mscMat) &lt;-<span class="st"> </span><span class="kw">colnames</span>(spectra)
<span class="kw">return</span>(mscMat)}</code></pre></div>
<p>As you may note above, the first part of this function generates the mean spectrum <tt>meanSpec</tt>. Then for each spectrum we derive the coefficients using the <tt>lm</tt> function. The coefficients are saved in the <tt>specCE</tt> object, which are then used for the correction calculation. The MSC algorithm is also implemented in the <tt>filter_spectra</tt> by specifying ‘MSC’ in the <tt>type</tt> option.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">spec_mscC &lt;-<span class="st"> </span><span class="kw">filter_spectra</span>(spec_filtered, <span class="dt">type =</span> <span class="st">&quot;MSC&quot;</span>)
<span class="co">#Plot first spectrum</span>
<span class="kw">plot</span>(wavelength, spec_mscC[<span class="dv">1</span>, ], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;MSC units&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" alt /></p>
</div>
<div id="continuum-removal" class="section level2">
<h2>Continuum Removal</h2>
<p>Convex hull or continuum removal (CR) is one type of baseline method that works by fitting a convex hull to each spectrum and computing the deviations from the hull <span class="citation">(Clark and Roush 1984)</span>. For absorbance spectra, CR gives value of 0 to all parts of the spectrum that lie on the convex hull and values between 0 and 1 to regions inside absorption bands. The opposite is true if we are dealing with reflectance data. Essentially CR accentuates the absorption bands in the spectra while minimizing brightness differences <span class="citation">(Buddenbaum and Steffens 2012)</span>. The function for applying CR involves a number of internal processes that are not important for understanding the main points of this algorithm, so we just apply the function and plot the first spectrum for illustrative purpose. Computing the convex hull is also implemented in the <tt>filter_spectra</tt> function via the ‘C-hull’ option for the <tt>type</tt> parameter. An addition parameter <tt>specType</tt> also needs to be specified, which we indicate as either 0 if the data is in absorbance units or 1 if the data is in reflectance units.<br />
</p>
<p>Note that the convex hull does not always work as intended if applied to the full spectrum range of the data because of issue with defining the hull points, then approximating the associated continuum line. The convex hull is usually applied when we are dealing with discrete regions of a spectrum. In the example below we will use <tt>filter_spectra</tt> function upon a specific NIR wavelength region where the secondary clay mineral Kaolinite can be detected. This region is between 2079-2277nm <span class="citation">(Clark et al. 2007)</span>. We will apply this function to the reflectance data. First we trim the spectral library to the specified region, then apply the <tt>chBLC</tt> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># First trim reflectance spectra to region</span>
specTrim.r &lt;-<span class="st"> </span><span class="kw">trimSpec</span>(<span class="dt">spectra =</span> spectra, <span class="dt">wavlimits =</span> <span class="kw">range</span>(<span class="dv">2079</span>:<span class="dv">2277</span>))

<span class="co"># Apply CR function</span>
spec_chC &lt;-<span class="st"> </span><span class="kw">filter_spectra</span>(specTrim.r, <span class="dt">type =</span> <span class="st">&quot;C-hull&quot;</span>, <span class="dt">specType =</span> <span class="dv">1</span>)

<span class="co">#Plot first spectrum</span>
<span class="kw">plot</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">2079</span>,<span class="dt">to =</span> <span class="dv">2277</span>,<span class="dt">by =</span> <span class="dv">1</span>), spec_chC[<span class="dv">1</span>, ], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;CR units&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;wavelength&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA8AAAAHgCAMAAABdO/S2AAAAeFBMVEUAAAAAADoAAGYAOjoAOpAAZrY6AAA6ADo6AGY6Ojo6OpA6ZmY6kLY6kNtmAABmADpmZgBmZmZmkJBmtrZmtv+QOgCQkGaQtpCQ2/+2ZgC2kDq2tma225C2/7a2///bkDrbkJDb/7bb////tmb/25D//7b//9v///9zV/i5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAU90lEQVR4nO3dC3viSnaFYbljd59JYk4mY2dMLk3GGOv//8PRBQTGSOhSu1Rr1/c+mT7qbgeq9q7VAkmgogQgq1h7AADmI8CAMAIMCCPAgDACDAgjwIAwAgwII8CAMAIMCCPAgDACDAgjwIAwAgwII8CAMAIMCCPAgDACDAgjwIAwAgwII8CAMAIMCCPAgDACDAgjwIAwAgwII8CAMAIMCCPAgDACDAgjwIAwAgwII8CAMAIMCCPAgDACDAgjwIAwAgwII8CAMAIMCCPAgDACDAgjwIAwAgwII8CAMAIMCCPAgDACDAgjwIAwAgwII8CAMAIMCCPAgDACDAgjwIAwAgwII8CAMAIMCCPAgDACDAgjwIAwAgwII8CAMAIMCCPAgDACDAgjwIAwAgwII8CAMAIMCJsW4M/XovHjt9FwAEwxKcC74rnd2J82AKxpSoA/X7vY7h7fDQYDYJopAT5sXk6be15EAwlgDwwIm/ge+LgL5j0wkIRpR6EPm/YoNPtfIAmcBwaEBQ5wASAAmwDfvZCDHToQgE2A71/IQYCBAEwCPOI0EgEGAjAJ8IgLOQgwEAB7YECY1XvgexdyEGAgAKOj0Hcv5CDAQABGAY79cECeCDAgjAs5AGGRL+QYewXY8N9PvIgsoouRXU/0esTJzgEJuZ+U0Y804VlDnEYacfln5OV/K5Ff63sxsm8/Vlz++fnviTB6jfkHXvtCjni7sJ5Ell9COfaRrvbEocYIV8YtjGT3wGPN+FzGnCe5Pwi7R0eGxi4KTxdyBAzx1WvgQI86+HS8J87enHeH3i7kCBGEnqNQUZDgbDUrbfKa83oeeH7yVt4LshPO1Nzlavz4kR7u9nP0/HN2688TehG7/ggQ39yuWwd4l8DHCXvOQiV7MiepwSCOVAMc6eFmS2Sv+1VyA4K12R3PPcCJojyZIcDOsBPOyvxuE+BUpffKHlaWXAUU4TkiPJxPZNizi6OpSx4l+A+W58s4agkchVZGnbwqutMgy646Cv6Dtc/Xe3cVZWGORKF8uvgsTJDHCfeDjc/Xp5APlzEK5VOwq/aNnnBfvAz+PetyLCrlUbhP40V/RpOH84xS+ROupwQ4fdTKm4AdJcACOJvkS8h2EmAJlMuRoM0kwBrYCTtg8YFVAqyCCIuzaSAB1kHNhFn9+0uAhbATlmXWOQIshbJpsf+iJgKshboJifGKiQCLoXAyorSKAIuhcCridIoAq6FyGiL1iQDLoXQKYnWJAOuhdumL1iMCrIfaJSz2/T0IsCCKl6r4l9oQYEVUL0lrXClHgCVRvuSs9B3ABFgTl0WnZMX7axFgVVQwEet+/T4BlkUJU7D2SyECrIsarm/1HhBgYRRxZWvvfksCrI0qriqF8kcOcGH/CeesUMYVJVF89sDaqONaEtkHEWBt1HElqRSeAIujkGtIZPdbEmB9VDK6dOJLgB2glHGlFF8C7AG1jCit+BJgD6hlPMnVmgA7QDEjSW33WxJgH6hmFCmWmQC7QDkjSLLIBNgH6mktwZfPNQLsBAW1lWp9CbAXVNRQorvfkgA7QkmtpBtfAuwJNbWRdF0JsCMU1UDKu9+SAPtCVYNLvaQE2BXKGpTAN8cQYFcoayAy3/tEgH2hrkHolJEAO0NhAxAqIgF2hsIup1RDAuwNlV1KqoJGAf58bY8C/Pgd5OEwAaVdRqt+NgHeFc/txv60sejhMAm1XUSrfCYB/nztYrt7fF/8cJiG2i4hVj2TAB82L6fNfc+LaLEyaaG4C4gVjz2wR1R3kouLNiQu3rhk9R74uAvmPfA6KO8EbbHq6MrF1+wo9GHTHoXu2f+ywqxR3/FOtRKML+eBvaK+o2mXigA7RYFHEi+U8YUcL30/IF42AVR4HPE62QT449dbWe5+/C63fZdiiZdNASUeQ71KlqeRttWv26flD4d5qPF98jWyvJCjPgfMhRwrosi3nQ8361fIdA/81L6OXvpwmIsq31KcvytHv0BGF3I8vLVvhA8bXkKviTLfcHHhxsojCcDoKPS++ifuYSC/HkongTp/c3797KE4nAf2jTp/46skBNg5Cn3FWUG4kMM7Kv2Vs3pEvpCj6Ex5OCxBqS95qwYXcvhHrc/c1YILOfyj1mfuasGFHBmg2Cf+KsGFHDmg2kf+CsGFHFmg3A2HZeA8cB6od81hFQhwJii4j0snr1kHmINYqci94i7jyx44I3mX3OvsCXA+Mq65091vSYCzkm3RHU/c+MMM3F40KZlW3fO0jS7k4Paiacqy7K4nbXkpZY2bmyUlx7L7nrPlhxlqfJghLRnW3feU2QNnJrvCO5+w1Xtgbi+aqswq7326Rkehub1ourIqvfvJch44O1mV3v1kCXB+Mqq9/6kS4AxlU/wMJkqAc5RL9TOYJwHOUh7lz2GWBDhLWZSfSd7+wcPmudwNnCEK+7wwkUP9c5jjnABvH98/fj71fmV74OeFDb+fkD1xP8HG9ADXFzrvi5feq5wDPy+seL+/je/ZncwLcH3Lo75vuwr8vDDkOcKOp3Zpzkvop8Pm8b3/K5/DPi9M+Y2w24l9NesgVvHw9vm6KL+5lFeA0044ndY3nEbKndNOOJ3WNzPeA//51vyXg1hOuGyFy0ndMj/AHMTywmMvPM7ppqkB3hadno/qB35emHPYC4dT6jF/DxzpeWHPXzP8zagPB7HgsBvuJtSLAKN01w5n0xkyMcCHzfPp667677oQ9HkRg7N2OJvOEPbAqLnqh6vJ3EGA0fDUEE9zuWdGgO/euCzo8yISPx3xM5MR5nyYYVFypz4vYnHzuQYv8xhlzscJF1zBcb4MZP5jwIqPpviYxVjzPg8c8XkRkYuuuJjEaNMDvPSDhBOfFzE5aIuDKUwx4z3wvgiwC86szDLk+yI/gYnmvITmQg7H1BujPv6pOA+Mr7Q7oz36GQgwrii3Rnns8/ASGteEeyM89Jlm74GXfaNOhpUWItsc2YHPN/8lNHdm8Eu1O6rjXmB+gPlSO8c026M56mXmB5gvtfNMsj+Sg15odoC5M4Nvgg0SHPJy849Cc3tR3/Q6pDfiADgPjB5qLVIbbxgEGH3EeiQ23EAIMHpJNUlqsOEQYPRT6pLSWAMiwBgg1CahoYa0IMD/z3lg93TapDPSsCYHeHf8FMPnKxdyZECmTzIDDWxqgPcPb+X28b3cc3fCPIg0SmSY4U0McPOFWIfNy654WHaPwmwLLkejUxqjNDAxwM13yn6+/qW4cx3l3S9/z7bgeiRaJTFIC5MDXH+h3fbey+fd6Qf2fT+ZbcEFCfRKYIhG5gX4znXQn69dbHc9P5pvxQWl36z0R2hlXoDvvIC++O73vk8N51txRal3K/XxGTIJMHtgbxJvV+LDs2QS4Oo98HEXzHtgJ9LuV9qjMzU5wOfbkw1dyHH3Q8MZl1xTyg1LeWzWuBYa4yTcsYSHZo4AY6RkW5bswGKYHOD25oQfP4fPBG+L4qm5mKPvPmhZF11Uqj1LdVxRTA3wYdO+rT3997b62PO2eBq4G3jWRVeVZtPSHFUsUwPcXcPRG83yeBpp31wtzWkkR9JsWpqjimXyhxnunuEtjyeb2ks4uJDDkxS7luKYIpp1HrgxcGcG9sBeJdi2BIcU05xPI7WG7szQvQe+2GPPfF6kJL22pTeiuCa/B+4uwhr8RANHoZ1Krm/JDSiyqQH++PlytWH8vEhLYo1LbDjxTT4PfLy6ebfsG3UovKrEGpfYcOKbfiVW+2UbI7+Ro3cvnX3hZSXVuaQGswqbSyk/fr21R7m2V0e6zh+FmPJwSEhSnUtqMKswCfDx2PP2uf+Th1ReVkKtS2goazEJ8PFscX0yiQs53EmodQkNZS2me+Cn/rPFlF5XOr1LZySrsXkPvKuvwqrfCB82vIT2J5XmpTKONRl9HnhfFPVXv/fml9pLS6R7iQxjVXygHzOk0b40RrEuAow5UuhfCmNYnXWAOYjlVAINTGAI62MPjHlWvxZn7edPAwHGXCv3kCVUI8CYbd0msoRqRgHm9qI5WLWJrKCG0YUc3F40C2t2kRXUsLyUssZ3Yrm2YhtZQQ3LDzPU+DCDa+u1kQXUYg+MJVbrIwuoZfUemNuLZmKtRrKAWkZHobm9aC5WaiTr54jzwFhmnU6yfo4IMBZapZWsnyMCjIUI8JoIMJZaoZcsnxMCjMXiN5Plc0KAsVz0brJ8TggwAojcTlZPhwAjhLj9ZPV0CDCCiPoFHayeDgFGIPEizOI5I8AIJlZTWTxnBBjhROoqi+eMACOcOF1l7VwgwAgoSltZOxcIMEKK0VfWzgUCjKDsG8vSuUSAERQBjosAIyzzzrJ0LhFghGXdWVbOFwQYgRm3lpXzBQFGYAQ4JgKM0Ex7y8L5igAjOMvmsnC+IsAIz667rJsrkQNcdII8HNJEgKNhDwwDZu1l3VwhwLBg1F+WzTUCDBM2DWbZXCPAsGHRYVbNNwQYRgxazKr5hgDDSvges2q+IcAwE7rJLJrvCDDssGjMEWAYCtpm1swNBBiWQvaZNXMDAYYlAmyMAMNUuEazZG4hwDBFgG0RYNgK1WlWzE0EGLYIsCkCDGOBWs2KuYkAw1igr4II8ij+EGAYI8CWCDCsBek1C+Y2AgxrIXrNeulBgGEuQLNZLz0IMMwtbzbLpQ8Bhr3F3Wa59DEK8Odr++3PP34HeThoI8BmbAK8K57bjf1pY9HDQd3CdrNaepkE+PO1i+3u8X3xw0Hfsn6zWnqZBPiweTlt7nteRNOSvBBgI+yBEcWShrNY+lm9Bz7ugnkPjKMFHWex9DM6Cn3YtEehe/a/9CQ/8zvOWhnAeWBEMrvlrJUBBBixzO05a2WA0VHo3pfOcx4OTsxrOktliFGA/+1nz8GrOQ8HL2Z1naUyxCjAz+WueAr1cHBjRttZKYPMAlyfQhrIMG3J0/S+s1IGGQa4bDLMlVi4NLnxrJRBtgEO83BwZGrjWSjDCDDimth5FsowzgMjskmtZ53cQYAR25Tes07uMP5Gjpe+H6Ax+ZrQe5bJPTYB/vj1Vpa7H7/L7dVB6KIz5eHgy/jms0zusfw88Lb6ddtzKpjOZGyt920eWX4jR/1hfr6RA9+N7T6r5C7TPfBT+zp66cPBGwIcjNE3cjy8tW+EDxteQuO7ce1nkdxn9HZkXxTFw0B+6U3mRvWfRXIf54GxhjH9Z42MQICxihELgDUygnWAOYiFm+4vAJbIGOyBsY67K4AlMgYBxjrurQBWyCgEGCsZXgIskHGMP8zA7UXRa3ANsEDGMbqQg9uL4r6Bj7SwPkayvJSyxs3NMKBvGbA8xrL8MEONDzNgyO11wOoYjT0wVnVrIbA4xrN6D8ztRTHOjZXA4hjP6Cg0txfFWN+WAmtjAs4DY23F4G8xiABjdV9OJ7EyJiHASEBxYwtjEGCkoLj6L0YiwEhC/TKabxuejgAjEaR3DgIMCCPAgDACDAgjwIAwAgwII8CAMAIMCCPAgDACDAgjwIAwAgwIWy3AAAJYKcDxyU+g5mESHuYgOAm9EV+Rn0DNwyQ8zEFwEnojviI/gZqHSXiYg+Ak9EZ8RX4CNQ+T8DAHwUnojfiK/ARqHibhYQ6Ck9Ab8RX5CdQ8TMLDHAQnoTfiK/ITqHmYhIc5CE5Cb8RX5CdQ8zAJD3MQnITeiK/IT6DmYRIe5iA4Cb0RA+gQYEAYAQaEEWBAGAEGhBFgQBgBBoQRYEAYAQaEEWBAGAEGhBFgQBgBBoSpBfjztSiK53b744/f9X/2RfHw9mUjdd8ncdjUXyX6VOpMopvDeTLCjeg25BohFuDP16qou6bAVa1/1Gt/X/1J/b/zRupuTOLj13HcKpPo5nCejHAjzpOQa4RYgD9+vlS/7upFX/0LWf/n87X+h3P7dN5I3vdJlPvm11JnEt0cug3lRpw7ItcIsQC3mn8di+em2DeaoOFyEuXuuFLEJtHtoqoN6UZ0G3KNkAzwtq1rG+DmNU+12W2sO7bRLidRbv/SvgcTm8T2NNDtRf3F5vBlEnqNUAzw/ngAqClv++9n9Wu3serYRvsyicPm8b1aQM+l1iROc2g21BvRbOg1QjDA++L4Mkc5wF8n0W1KTeI8h9MxLOlGFN0bXqVG6AW4+xdT+SX01SRa1fsupUl82XXJN+LcEa1GyAV4dy607kGs60m0qkUjNIluDscN7UZcdESrEWoB3hUv3fZe9DTS90m0y2V/cS4med0cThvSjTht6DVCLMAfPy/+odyLXshxYxLNStk+60yim8N5MsKNOE9CrhFiAd61ty8/XrHXvsDZnX6/07j47eYkttUfvBz/UmES3RwuJqPbiItJqDVCLMAALhFgQBgBBoQRYEAYAQaEEWBAGAEGhBFgQBgBBoQRYEAYAQaEEWBAGAEGhBFgQBgBBoQRYEAYAQaEEWBAGAEGhBFgQBgBBoQRYEAYAQaEEWBAGAEGhBFgQBgBBoQR4MwcNi8Df7t/ufMDSAwBzsxgPuu/JMBSCHBmCLAvBNiPz9en6kVwfXPM7eP78T6ZxztWP7w199J8Pga42/7bpr2ZZvXDD//18PefRfH4j81//iwKQiyCADuyq3K7K57K+vby9Z2qdw9vTajrQFfbzX2s6wCft+tgV//b/vhdJf/hrd0DH/8QCgiwI/WOdvvXx/ePX2+HP9/KZve7q7J52DxX/1c2dxOvMnqx/dz8ULub3p4C3P7hynPBOATYkTqcf/79j99VNuvf7utXwnUmq2Dvm11qlcvq95fbzf9T+/P7U4Bf7h2rRjoIsCfb549//cefb83L56L48b/1frT6TfUKugpzownwxXaT1R0BlkWAPdk9/ncV139/PR68an7Z//i/difc/ki3By7Lkj2wPgLsyccf//Fc7v7l11vZZLI5In3Y/LV5G3xMZPMe+Lzd/NK+490RYEEE2JPmCPK+eHxvdr6HTX2uqNwW9YHo5rjy8TjV5XaT1fNR6GcCrIUAu1InsT5B1LwHfnjb1kndtyd163O/p13x5Xbzy7b6/f9Uf7KtzwMTYCEEGEfHY9eQQoDRHuxqzw5DDAFGc8aYqyc1EWBAGAEGhBFgQBgBBoQRYEAYAQaEEWBAGAEGhBFgQBgBBoQRYEAYAQaEEWBAGAEGhBFgQBgBBoQRYEAYAQaEEWBAGAEGhBFgQNg/AeFCc5peMQ6aAAAAAElFTkSuQmCC" alt /></p>
<p>If you are interested in further baseline and continuum removal algorithms, it is work checking out such R packages as <tt>baseline</tt>.</p>
</div>
</div>
<div id="spectral-or-dimension-reduction" class="section level1">
<h1>Spectral or dimension reduction</h1>
<div id="resampling-and-averaging" class="section level2">
<h2>Resampling and averaging</h2>
<p>Despite all the filtering and baseline corrections we may perform, some models we try to use for calibrating soil data with spectra are difficult to fit and validate when there are many wavelengths to consider. So we may want to reduce the dimensions of our spectra, but at the same time keep the important absorbance features. One such technique that could be used in tandem with the baseline corrections is simple aggregation through resampling and averaging. Essentially with a moving window of <em>n</em> size or wavelength we calculate the average. Thus the bigger the window, the more detail is lost from the spectrum.</p>
<p>The resampling and averaging function is called <tt>compSpec</tt> from the <tt>spectroscopy</tt> package, and it requires two inputs: the <tt>spectra</tt> that we want to resample and average, and <tt>window</tt> size. The window size can be arbitrarily selected. However, if the spectra range (though more importantly the number of columns) is not divisible by the window size, then an error will be produced, to which you will need to find an appropriate window size, or implement spectral trimming that will allow you to use that requested window size. In the following example we use the <tt>specTrim</tt> spectra data set from before (number of columns = 1952) and use a window size of 8 to reduce the column-wise dimension of the spectra library to 244.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Run Function</span>
spec_Comp &lt;-<span class="st"> </span><span class="kw">compSpec</span>(<span class="dt">spectra =</span> specTrim, <span class="dt">window =</span> <span class="dv">8</span>)

<span class="co">#dimension of spectra library</span>
<span class="kw">dim</span>(spec_Comp)</code></pre></div>
<pre><code>## [1] 389 244</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Plot first spectrum</span>
<span class="kw">plot</span>(<span class="kw">as.numeric</span>(<span class="kw">names</span>(spec_Comp)), spec_Comp[<span class="dv">1</span>, ], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;wavelength (nm)&quot;</span>, <span class="dt">ylab=</span> <span class="st">&quot;absorbance&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" alt /></p>
</div>
<div id="wavelets" class="section level2">
<h2>Wavelets</h2>
<p>Wavelets are a naturally useful tool for processing spectra in terms of filtering and performing dimension reduction. More importantly, with wavelets we can investigate distinct scales of variation within each spectrum by changing the support of the wavelet filtering function. Some further background on wavelets can be found in <span class="citation">Viscarra Rossel and Lark (2009)</span> for example. However for our purposes here, we just want to reduce our spectra down to a few important elements without losing the important absorbance features. We can run the wavelet function over the spectra for which it will compute the wavelet coefficients and a smoothed approximation of the data at each scale. Scale is represented as the support of the filter, where for example the increasing dilation of the support will result in smoother and more general representations of the original spectra. However, if we want to, we could reconstruct the original spectra from any scale by multiplying the wavelet coefficients and the smoother signal at each particular scale. What we are using the wavelet functions for here is to simply reduce the dimensions of our original spectra down to a few components i.e. just return the smoothed or more generalized spectra. Here we use the <tt>wavethresh</tt> package and its <tt>wd</tt> or wavelet. The help file for the <tt>wd</tt> function describes in more detail the parameters necessary for the wavelet filtering.</p>
<p>We have made a customized function that runs on top of the <tt>wd</tt> function so that it returns spectra at the requested scale. This wrapper function is implemented in the <tt>filter_spectra</tt> function of the <tt>spectroscopy</tt> package. To run the wavelet implementation we need to ensure our spectra in terms of numbers of wavelengths (the columns) is dyadic or in other words we just need a number for <em>x</em> in <span class="math inline">\(2^x\)</span>. Where vis-NIR spectra instruments output 1nm spectral resolution data within the 350-2500nm range (2151 wavelengths), it is most appropriate to find the nearest dyadic number which is 2048 or <span class="math inline">\(2^(11)\)</span>. A viable spectra range we may work with could be between and including 404nm and 2451nm in this specific case with this particular vis-NIR data. Essentially we need to do this procedure because the support of the wavelets are dilated by a factor of <span class="math inline">\(2^x\)</span> for each increasing scale.</p>
<p>With the appropriately trimmed spectra, the <tt>filter_spectra</tt> function requires two inputs: the <tt>spectra</tt> and an integer (less than 11 in this case) for <tt>res</tt> which indicates the scale that we want to output the smoothed spectra. The example below uses the original unfiltered absorbance spectra <tt>spectraA</tt> from earlier. We will set the resolution <tt>res</tt> to 8. Keep in mind that setting <tt>res</tt> to 11 in this case will potentially return the original spectra table, yet the function does not allow this to occur because it is a redundant operation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(wavethresh)
<span class="co">#First Trim the spectraA object to 404-2451 spectral range</span>
specTrim2 &lt;-<span class="st"> </span><span class="kw">trimSpec</span>(spectraA, <span class="dt">wavlimits =</span> <span class="kw">range</span>(<span class="dv">404</span>:<span class="dv">2451</span>)) 

<span class="co">#Run wavelet smooth function </span>
res &lt;-<span class="st"> </span><span class="dv">8</span> <span class="co"># the resolution of the decomposed spectra # res =11 when you want to return the original data spec_wavelet </span>
spec_wavelet &lt;-<span class="st"> </span><span class="kw">filter_spectra</span>(specTrim2, <span class="dt">type =</span> <span class="st">&quot;Wavelet&quot;</span>, <span class="dt">res =</span> <span class="dv">8</span>)
<span class="kw">dim</span>(spec_wavelet)</code></pre></div>
<pre><code>## [1] 389 256</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Plot first spectrum</span>
<span class="kw">plot</span>(<span class="kw">as.numeric</span>(<span class="kw">names</span>(spec_wavelet)), spec_wavelet[<span class="dv">1</span>, ], <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">xlab=</span><span class="st">&quot;wavelength (nm)&quot;</span>, <span class="dt">ylab=</span> <span class="st">&quot;wavelet values&quot;</span>)</code></pre></div>
<p><img src="data:image/png;base64,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" alt /></p>
</div>
</div>
<div id="exercise" class="section level1">
<h1>Exercise</h1>
<p>To evaluate the differences between the various filtering, smoothing and baseline corrections we have just investigated (and to slightly challenge yourself), plot the spectra which correspond to the maximum, minimum, and median soil carbon concentrations using each of the different pretreatments. Hint: you will first need to merge the relevant soil data to their corresponding vis-NIR spectra as a first step.</p>
</div>
<div id="references" class="section level1 unnumbered">
<h1>References</h1>
<div id="refs" class="references">
<div id="ref-budden2012">
<p>Buddenbaum, H., and M. Steffens. 2012. “The Effects of Spectral Pretreatments on Chemometric Analyses of Soil Profiles Using Laboratory Imaging Spectroscopy.” <em>Applied and Environmental Soil Science</em>, Article ID: 274903.</p>
</div>
<div id="ref-clark1">
<p>Clark, R.N., and T.L Roush. 1984. “Refectance Spectroscopy - Quantitative Analysis Techniques for Remote Sensing Applications.” <em>Journal of Geophysical Research</em>, no. 89(NB7): 6329–40.</p>
</div>
<div id="ref-clark2">
<p>Clark, R.N., G.A. Swayze, R. Wise, K.E. Livo, T.M. Hoefen, R.F. Kokaly, and S.J. Sutley. 2007. “USGS Digital Spectral Library Splib06a.” <em>Geological Survey, Data Series</em> 231.</p>
</div>
<div id="ref-viscarra1">
<p>Viscarra Rossel, R., and R.M. Lark. 2009. “Improved Analysis and Modelling of Soil Diffuse Reflectance Spectra Using Wavelets.” <em>European Journal of Soil Science</em> 60 (3): 453–64.</p>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
